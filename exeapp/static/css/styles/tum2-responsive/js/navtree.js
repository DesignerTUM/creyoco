// Generated by CoffeeScript 1.4.0
(function() {
  var __slice = [].slice;

  $(function() {
    var active, debounce, hide, lastTimeout, left, narrow, show, update, wide;
    show = function(el) {
      return el.addClass("navshown").removeClass("navhidden");
    };
    hide = function(el) {
      return el.removeClass("navshown").addClass("navhidden");
    };
    lastTimeout = void 0;
    update = function() {
      clearTimeout(lastTimeout);
      return lastTimeout = setTimeout((function() {
        $(".navshown").slideDown();
        return $(".navhidden:not(.neverhide)").slideUp();
      }), 200);
    };
    left = $("aside.left > nav");
    hide(left.find("ul > li > ul").hide());
    active = left.find(".active").parent();
    active.show().addClass("neverhide");
    active.find("> li, > ul").show().addClass("neverhide");
    active.parents("ul").show().addClass("neverhide");
    debounce = function(func, threshold, execAsap) {
      var timeout;
      timeout = null;
      return function() {
        var args, delayed, obj;
        args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
        obj = this;
        delayed = function() {
          if (!execAsap) {
            func.apply(obj, args);
          }
          return timeout = null;
        };
        if (timeout) {
          clearTimeout(timeout);
        } else if (execAsap) {
          func.apply(obj, args);
        }
        return timeout = setTimeout(delayed, threshold || 100);
      };
    };
    narrow = debounce((function() {
      var a_list, menu_toggle;
      left.find("li").off();
      left.find();
      a_list = $(".left").find("ul").not(".neverhide").parent().children("a");
      a_list.each(function() {
        var a, url_text;
        a = $(this);
        url_text = a.html();
        if (url_text.indexOf("</span>") === -1) {
          a.html(url_text + '<span class=\'glyphicon glyphicon-chevron-down\'></span>');
        }
      });
      $('.left .glyphicon').off('click');
      $('.left .glyphicon').on('click', function(e) {
        var parent;
        e.preventDefault();
        if ($(this).hasClass('glyphicon-chevron-down')) {
          $(this).removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
          parent = $(this).parent().parent();
          show(parent.find("> ul"));
          show(parent.parents("ul"));
          return update();
        } else if ($(this).hasClass('glyphicon-chevron-up')) {
          $(this).removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
          parent = $(this).parent().parent();
          hide(parent.find("> ul"));
          return update();
        }
      });
      menu_toggle = $('#menu-toggle');
      menu_toggle.off();
      return menu_toggle.click(function(e) {
        e.preventDefault();
        $('body').toggleClass('active');
      });
    }), 500);
    wide = debounce((function() {
      left.find("span.glyphicon").remove();
      left.find("li").on("mouseover", function(ev) {
        show($(this).find("> ul"));
        show($(this).parents("ul"));
        return update();
      });
      return left.find("li").on("mouseout", function(ev) {
        hide($(this).find("> ul"));
        return update();
      });
    }), 500);
    $(window).on('resize', function() {
      if ($(this).width() > 1200) {
        return wide();
      } else {
        return narrow();
      }
    });
    if ($(window).width() > 1200) {
      wide();
    } else {
      narrow();
    }
    $('header').affix();
    $(window).on('scroll', function() { $('header').affix('checkPosition'); });
    $('header')
      .on('affixed.bs.affix', function() {
        $('header').data('affixed', true);
        $('.middle').addClass('withAffix');
      })
      .on('affix.bs.affix affix-top.bs.affix', function(evt) {
        if (!!$(this).data('affixed')) {
          evt.preventDefault();
        }
      });

    $('.left').affix();
    $('.rightimages').affix();
  });

}).call(this);
